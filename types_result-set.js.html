<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>JSDoc: Source: types/result-set.js</title>

    <script src="scripts/prettify/prettify.js"> </script>
    <script src="scripts/prettify/lang-css.js"> </script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/prettify-tomorrow.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc-default.css">
</head>

<body>

<div id="main">

    <h1 class="page-title">Source: types/result-set.js</h1>

    



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>"use strict";

const utils = require("../utils");
const errors = require("../errors");

const asyncIteratorSymbol = Symbol.asyncIterator || "@@asyncIterator";

/** @module types */

/**
 * Creates a new instance of ResultSet.
 * @class
 * @classdesc Represents the result of a query.
 * @param {Object} response
 * @param {String} host
 * @param {Object} triedHosts
 * @param {Number} speculativeExecutions
 * @param {Number} consistency
 * @param {Boolean} isSchemaInAgreement
 * @constructor
 */
function ResultSet(
    response,
    host,
    triedHosts,
    speculativeExecutions,
    consistency,
    isSchemaInAgreement,
) {
    // if no execution was made at all, set to 0.
    if (speculativeExecutions === -1) {
        speculativeExecutions = 0;
    }
    /**
     * Information on the execution of a successful query:
     * @member {Object}
     * @property {Number} achievedConsistency The consistency level that has been actually achieved by the query.
     * @property {String} queriedHost The Cassandra host that coordinated this query.
     * @property {Object} triedHosts Gets the associative array of host that were queried before getting a valid response,
     * being the last host the one that replied correctly.
     * @property {Object} speculativeExecutions The number of speculative executions (not including the first) executed before
     * getting a valid response.
     * @property {Uuid} traceId Identifier of the trace session.
     * @property {Array.&lt;string>} warnings Warning messages generated by the server when executing the query.
     * @property {Boolean} isSchemaInAgreement Whether the cluster had reached schema agreement after the execution of
     * this query.
     * &lt;p>
     *   After a successful schema-altering query (ex: creating a table), the driver will check if
     *   the cluster's nodes agree on the new schema version. If not, it will keep retrying for a given
     *   delay (see &lt;code>protocolOptions.maxSchemaAgreementWaitSeconds&lt;/code>).
     * &lt;/p>
     * &lt;p>
     *   Note that the schema agreement check is only performed for schema-altering queries For other
     *   query types, this method will always return &lt;code>true&lt;/code>. If this method returns &lt;code>false&lt;/code>,
     *   clients can call [Metadata.checkSchemaAgreement()]{@link module:metadata~Metadata#checkSchemaAgreement} later to
     *   perform the check manually.
     * &lt;/p>
     */
    this.info = {
        queriedHost: host,
        triedHosts: triedHosts,
        speculativeExecutions: speculativeExecutions,
        achievedConsistency: consistency,
        traceId: null,
        warnings: null,
        customPayload: null,
        isSchemaInAgreement,
    };

    if (response.flags) {
        this.info.traceId = response.flags.traceId;
        this.info.warnings = response.flags.warnings;
        this.info.customPayload = response.flags.customPayload;
    }

    /**
     * Gets an array rows returned by the query.
     * When the result set represents a response from a write query, this property will be &lt;code>undefined&lt;/code>.
     * When the read query result contains more rows than the fetch size (5000), this property will only contain the
     * first rows up to fetch size. To obtain all the rows, you can use the built-in async iterator that will retrieve the
     * following pages of results.
     * @type {Array&lt;Row>|undefined}
     */
    this.rows = response.rows;

    /**
     * Gets the row length of the result, regardless if the result has been buffered or not
     * @type {Number|undefined}
     */
    this.rowLength = this.rows ? this.rows.length : response.rowLength;

    /**
     * Gets the columns returned in this ResultSet.
     * @type {Array.&lt;{name, type}>}
     * @default null
     */
    this.columns = null;

    /**
     * A string token representing the current page state of query. It can be used in the following executions to
     * continue paging and retrieve the remained of the result for the query.
     * @type {String|null}
     * @default null
     */
    this.pageState = null;

    /**
     * Method used to manually fetch the next page of results.
     * This method is only exposed when using the {@link Client#eachRow} method and there are more rows available in
     * following pages.
     * @type Function
     */
    this.nextPage = undefined;

    /**
     * Method used internally to fetch the next page of results using promises.
     * @internal
     * @ignore
     * @type {Function}
     */
    this.nextPageAsync = undefined;

    const meta = response.meta;

    if (meta) {
        this.columns = meta.columns;

        if (meta.pageState) {
            this.pageState = meta.pageState.toString("hex");

            // Expose rawPageState internally
            Object.defineProperty(this, "rawPageState", {
                value: meta.pageState,
                enumerable: false,
            });
        }
    }
}

/**
 * Returns the first row or null if the result rows are empty.
 */
ResultSet.prototype.first = function () {
    if (this.rows &amp;&amp; this.rows.length) {
        return this.rows[0];
    }
    return null;
};

ResultSet.prototype.getPageState = function () {
    // backward-compatibility
    return this.pageState;
};

ResultSet.prototype.getColumns = function () {
    // backward-compatibility
    return this.columns;
};

/**
 * When this instance is the result of a conditional update query, it returns whether it was successful.
 * Otherwise, it returns &lt;code>true&lt;/code>.
 * &lt;p>
 *   For consistency, this method always returns &lt;code>true&lt;/code> for non-conditional queries (although there is
 *   no reason to call the method in that case). This is also the case for conditional DDL statements
 *   (CREATE KEYSPACE... IF NOT EXISTS, CREATE TABLE... IF NOT EXISTS), for which the server doesn't return
 *   information whether it was applied or not.
 * &lt;/p>
 */
ResultSet.prototype.wasApplied = function () {
    if (!this.rows || this.rows.length === 0) {
        return true;
    }
    const firstRow = this.rows[0];
    const applied = firstRow["[applied]"];
    return typeof applied === "boolean" ? applied : true;
};

/**
 * Gets the iterator function.
 * &lt;p>
 *   Retrieves the iterator of the underlying fetched rows, without causing the driver to fetch the following
 *   result pages. For more information on result paging,
 *   [visit the documentation]{@link http://docs.datastax.com/en/developer/nodejs-driver/latest/features/paging/}.
 * &lt;/p>
 * @alias module:types~ResultSet#@@iterator
 * @see {@link module:types~ResultSet#@@asyncIterator}
 * @example &lt;caption>Using for...of statement&lt;/caption>
 * const query = 'SELECT user_id, post_id, content FROM timeline WHERE user_id = ?';
 * const result = await client.execute(query, [ id ], { prepare: true });
 * for (const row of result) {
 *   console.log(row['email']);
 * }
 * @returns {Iterator.&lt;Row>}
 */
ResultSet.prototype[Symbol.iterator] = function getIterator() {
    if (!this.rows) {
        return utils.emptyArray[Symbol.iterator]();
    }
    return this.rows[Symbol.iterator]();
};

/**
 * Gets the async iterator function.
 * &lt;p>
 *   Retrieves the async iterator representing the entire query result, the driver will fetch the following result
 *   pages.
 * &lt;/p>
 * &lt;p>Use the async iterator when the query result might contain more rows than the &lt;code>fetchSize&lt;/code>.&lt;/p>
 * &lt;p>
 *   Note that using the async iterator will not affect the internal state of the &lt;code>ResultSet&lt;/code> instance.
 *   You should avoid using both &lt;code>rows&lt;/code> property that contains the row instances of the first page of
 *   results, and the async iterator, that will yield all the rows in the result regardless on the number of pages.
 * &lt;/p>
 * &lt;p>Multiple concurrent async iterations are not supported.&lt;/p>
 * @alias module:types~ResultSet#@@asyncIterator
 * @example &lt;caption>Using for await...of statement&lt;/caption>
 * const query = 'SELECT user_id, post_id, content FROM timeline WHERE user_id = ?';
 * const result = await client.execute(query, [ id ], { prepare: true });
 * for await (const row of result) {
 *   console.log(row['email']);
 * }
 * @returns {AsyncIterator&lt;Row>}
 */
ResultSet.prototype[asyncIteratorSymbol] = function getAsyncGenerator() {
    let index = 0;
    let pageState = this.rawPageState;
    let rows = this.rows;

    if (!rows || rows.length === 0) {
        return { next: () => Promise.resolve({ done: true }) };
    }

    const self = this;

    // Async generators are not present in Node.js 8, implement it manually
    return {
        async next() {
            if (index >= rows.length &amp;&amp; pageState) {
                if (!self.nextPageAsync) {
                    throw new errors.DriverInternalError(
                        "Property nextPageAsync should be set when pageState is defined",
                    );
                }

                const rs = await self.nextPageAsync(pageState);
                rows = rs.rows;
                index = 0;
                pageState = rs.rawPageState;
            }

            if (index &lt; rows.length) {
                return { done: false, value: rows[index++] };
            }

            return { done: true };
        },
    };
};

/**
 * Determines whether there are more pages of results.
 * If so, the driver will initially retrieve and contain only the first page of results.
 * To obtain all the rows, use the [AsyncIterator]{@linkcode module:types~ResultSet#@@asyncIterator}.
 * @returns {boolean}
 */
ResultSet.prototype.isPaged = function () {
    return !!this.rawPageState;
};

module.exports = ResultSet;
</code></pre>
        </article>
    </section>




</div>

<nav>
    <h2><a href="index.html">Home</a></h2><h3>Modules</h3><ul><li><a href="module-auth.html">auth</a></li><li><a href="module-concurrent.html">concurrent</a></li><li><a href="module-datastax.html">datastax</a></li><li><a href="module-errors.html">errors</a></li><li><a href="module-geometry.html">geometry</a></li><li><a href="module-mapping.html">mapping</a></li><li><a href="module-metadata.html">metadata</a></li><li><a href="module-metrics.html">metrics</a></li><li><a href="module-policies.html">policies</a></li><li><a href="module-policies_addressResolution.html">policies/addressResolution</a></li><li><a href="module-policies_loadBalancing.html">policies/loadBalancing</a></li><li><a href="module-policies_reconnection.html">policies/reconnection</a></li><li><a href="module-policies_retry.html">policies/retry</a></li><li><a href="module-policies_speculativeExecution.html">policies/speculativeExecution</a></li><li><a href="module-policies_timestampGeneration.html">policies/timestampGeneration</a></li><li><a href="module-tracker.html">tracker</a></li><li><a href="module-types.html">types</a></li></ul><h3>Classes</h3><ul><li><a href="AddressResolver.html">AddressResolver</a></li><li><a href="AuthResponseRequest.html">AuthResponseRequest</a></li><li><a href="BatchRequest.html">BatchRequest</a></li><li><a href="ByteOrderedToken.html">ByteOrderedToken</a></li><li><a href="Client.html">Client</a></li><li><a href="Connection.html">Connection</a></li><li><a href="ControlConnection.html">ControlConnection</a></li><li><a href="CredentialsRequest.html">CredentialsRequest</a></li><li><a href="Encoder.html">Encoder</a></li><li><a href="ExecuteRequest.html">ExecuteRequest</a></li><li><a href="ExecutionOptions.html">ExecutionOptions</a></li><li><a href="ExecutionProfile.html">ExecutionProfile</a></li><li><a href="FrameReader.html">FrameReader</a></li><li><a href="FrameWriter.html">FrameWriter</a></li><li><a href="HashSet.html">HashSet</a></li><li><a href="Host.html">Host</a></li><li><a href="HostConnectionPool.html">HostConnectionPool</a></li><li><a href="HostMap.html">HostMap</a></li><li><a href="InsightsClient.html">InsightsClient</a></li><li><a href="LineString.html">LineString</a></li><li><a href="Murmur3Token.html">Murmur3Token</a></li><li><a href="Murmur3Tokenizer.html">Murmur3Tokenizer</a></li><li><a href="OperationState.html">OperationState</a></li><li><a href="Point.html">Point</a></li><li><a href="Polygon.html">Polygon</a></li><li><a href="PrepareHandler.html">PrepareHandler</a></li><li><a href="QueryRequest.html">QueryRequest</a></li><li><a href="RandomToken.html">RandomToken</a></li><li><a href="RandomTokenizer.html">RandomTokenizer</a></li><li><a href="Request.html">Request</a></li><li><a href="RequestExecution.html">RequestExecution</a></li><li><a href="RequestHandler.html">RequestHandler</a></li><li><a href="StartupRequest.html">StartupRequest</a></li><li><a href="StreamIdStack.html">StreamIdStack</a></li><li><a href="Token.html">Token</a></li><li><a href="TokenRange.html">TokenRange</a></li><li><a href="Tokenizer.html">Tokenizer</a></li><li><a href="TransitionalModePlainTextAuthenticator.html">TransitionalModePlainTextAuthenticator</a></li><li><a href="WriteQueue.html">WriteQueue</a></li><li><a href="module-auth-AuthProvider.html">AuthProvider</a></li><li><a href="module-auth-Authenticator.html">Authenticator</a></li><li><a href="module-auth-PlainTextAuthProvider.html">PlainTextAuthProvider</a></li><li><a href="module-errors-ArgumentError.html">ArgumentError</a></li><li><a href="module-errors-AuthenticationError.html">AuthenticationError</a></li><li><a href="module-errors-BusyConnectionError.html">BusyConnectionError</a></li><li><a href="module-errors-DriverInternalError.html">DriverInternalError</a></li><li><a href="module-errors-NoHostAvailableError.html">NoHostAvailableError</a></li><li><a href="module-errors-NotSupportedError.html">NotSupportedError</a></li><li><a href="module-errors-OperationTimedOutError.html">OperationTimedOutError</a></li><li><a href="module-errors-ResponseError.html">ResponseError</a></li><li><a href="module-mapping-DefaultTableMappings.html">DefaultTableMappings</a></li><li><a href="module-mapping-Mapper.html">Mapper</a></li><li><a href="module-mapping-ModelBatchItem.html">ModelBatchItem</a></li><li><a href="module-mapping-ModelMapper.html">ModelMapper</a></li><li><a href="module-mapping-Result.html">Result</a></li><li><a href="module-mapping-UnderscoreCqlToCamelCaseMappings.html">UnderscoreCqlToCamelCaseMappings</a></li><li><a href="module-metadata-Aggregate.html">Aggregate</a></li><li><a href="module-metadata-ClientState.html">ClientState</a></li><li><a href="module-metadata-DataCollection.html">DataCollection</a></li><li><a href="module-metadata-Index.html">Index</a></li><li><a href="module-metadata-MaterializedView.html">MaterializedView</a></li><li><a href="module-metadata-Metadata.html">Metadata</a></li><li><a href="module-metadata-SchemaFunction.html">SchemaFunction</a></li><li><a href="module-metadata-TableMetadata.html">TableMetadata</a></li><li><a href="module-metrics-DefaultMetrics.html">DefaultMetrics</a></li><li><a href="module-policies_addressResolution-AddressTranslator.html">AddressTranslator</a></li><li><a href="module-policies_addressResolution-EC2MultiRegionTranslator.html">EC2MultiRegionTranslator</a></li><li><a href="module-policies_loadBalancing-AllowListPolicy.html">AllowListPolicy</a></li><li><a href="module-policies_loadBalancing-DCAwareRoundRobinPolicy.html">DCAwareRoundRobinPolicy</a></li><li><a href="module-policies_loadBalancing-DefaultLoadBalancingPolicy.html">DefaultLoadBalancingPolicy</a></li><li><a href="module-policies_loadBalancing-LoadBalancingPolicy.html">LoadBalancingPolicy</a></li><li><a href="module-policies_loadBalancing-RoundRobinPolicy.html">RoundRobinPolicy</a></li><li><a href="module-policies_loadBalancing-TokenAwarePolicy.html">TokenAwarePolicy</a></li><li><a href="module-policies_loadBalancing-WhiteListPolicy.html">WhiteListPolicy</a></li><li><a href="module-policies_reconnection-ConstantReconnectionPolicy.html">ConstantReconnectionPolicy</a></li><li><a href="module-policies_reconnection-ExponentialReconnectionPolicy.html">ExponentialReconnectionPolicy</a></li><li><a href="module-policies_reconnection-ReconnectionPolicy.html">ReconnectionPolicy</a></li><li><a href="module-policies_retry-FallthroughRetryPolicy.html">FallthroughRetryPolicy</a></li><li><a href="module-policies_retry-IdempotenceAwareRetryPolicy.html">IdempotenceAwareRetryPolicy</a></li><li><a href="module-policies_retry-RetryPolicy.html">RetryPolicy</a></li><li><a href="module-policies_speculativeExecution-ConstantSpeculativeExecutionPolicy.html">ConstantSpeculativeExecutionPolicy</a></li><li><a href="module-policies_speculativeExecution-NoSpeculativeExecutionPolicy.html">NoSpeculativeExecutionPolicy</a></li><li><a href="module-policies_speculativeExecution-SpeculativeExecutionPolicy.html">SpeculativeExecutionPolicy</a></li><li><a href="module-policies_timestampGeneration-MonotonicTimestampGenerator.html">MonotonicTimestampGenerator</a></li><li><a href="module-policies_timestampGeneration-TimestampGenerator.html">TimestampGenerator</a></li><li><a href="module-tracker-RequestLogger.html">RequestLogger</a></li><li><a href="module-types-BigDecimal.html">BigDecimal</a></li><li><a href="module-types-Duration.html">Duration</a></li><li><a href="module-types-InetAddress.html">InetAddress</a></li><li><a href="module-types-Integer.html">Integer</a></li><li><a href="module-types-LocalDate.html">LocalDate</a></li><li><a href="module-types-LocalTime.html">LocalTime</a></li><li><a href="module-types-Long.html">Long</a></li><li><a href="module-types-ResultSet.html">ResultSet</a></li><li><a href="module-types-ResultStream.html">ResultStream</a></li><li><a href="module-types-Row.html">Row</a></li><li><a href="module-types-TimeUuid.html">TimeUuid</a></li><li><a href="module-types-Tuple.html">Tuple</a></li><li><a href="module-types-Uuid.html">Uuid</a></li></ul><h3>Interfaces</h3><ul><li><a href="module-mapping-TableMappings.html">TableMappings</a></li><li><a href="module-metrics-ClientMetrics.html">ClientMetrics</a></li><li><a href="module-tracker-RequestTracker.html">RequestTracker</a></li></ul><h3>Events</h3><ul><li><a href="Client.html#event:hostAdd">hostAdd</a></li><li><a href="Client.html#event:hostDown">hostDown</a></li><li><a href="Client.html#event:hostRemove">hostRemove</a></li><li><a href="Client.html#event:hostUp">hostUp</a></li></ul><h3>Global</h3><ul><li><a href="global.html#Parser">Parser</a></li><li><a href="global.html#Protocol">Protocol</a></li><li><a href="global.html#ResultEmitter">ResultEmitter</a></li><li><a href="global.html#adaptNamedParamsPrepared">adaptNamedParamsPrepared</a></li><li><a href="global.html#adaptNamedParamsWithHints">adaptNamedParamsWithHints</a></li><li><a href="global.html#allocBuffer">allocBuffer</a></li><li><a href="global.html#allocBufferFromArray">allocBufferFromArray</a></li><li><a href="global.html#allocBufferFromString">allocBufferFromString</a></li><li><a href="global.html#allocBufferUnsafe">allocBufferUnsafe</a></li><li><a href="global.html#arrayIterator">arrayIterator</a></li><li><a href="global.html#binarySearch">binarySearch</a></li><li><a href="global.html#callbackOnce">callbackOnce</a></li><li><a href="global.html#copyBuffer">copyBuffer</a></li><li><a href="global.html#coreConnectionsPerHostV2">coreConnectionsPerHostV2</a></li><li><a href="global.html#coreConnectionsPerHostV3">coreConnectionsPerHostV3</a></li><li><a href="global.html#deepExtend">deepExtend</a></li><li><a href="global.html#defaultOptions">defaultOptions</a></li><li><a href="global.html#defaultPromiseFactory">defaultPromiseFactory</a></li><li><a href="global.html#defaultReleaseDelay">defaultReleaseDelay</a></li><li><a href="global.html#delay">delay</a></li><li><a href="global.html#each">each</a></li><li><a href="global.html#eachSeries">eachSeries</a></li><li><a href="global.html#emptyArray">emptyArray</a></li><li><a href="global.html#emptyObject">emptyObject</a></li><li><a href="global.html#encodeVector">encodeVector</a></li><li><a href="global.html#errorCodes">errorCodes</a></li><li><a href="global.html#extend">extend</a></li><li><a href="global.html#fixStack">fixStack</a></li><li><a href="global.html#forEachOf">forEachOf</a></li><li><a href="global.html#fromCallback">fromCallback</a></li><li><a href="global.html#fromEvent">fromEvent</a></li><li><a href="global.html#fromSignedByte">fromSignedByte</a></li><li><a href="global.html#getCallback">getCallback</a></li><li><a href="global.html#getDefaultOptions">getDefaultOptions</a></li><li><a href="global.html#groupSize">groupSize</a></li><li><a href="global.html#ifUndefined">ifUndefined</a></li><li><a href="global.html#ifUndefined3">ifUndefined3</a></li><li><a href="global.html#insertSorted">insertSorted</a></li><li><a href="global.html#iteratorToArray">iteratorToArray</a></li><li><a href="global.html#log">log</a></li><li><a href="global.html#map">map</a></li><li><a href="global.html#mapSeries">mapSeries</a></li><li><a href="global.html#maxGroupsFor2Bytes">maxGroupsFor2Bytes</a></li><li><a href="global.html#maxInt">maxInt</a></li><li><a href="global.html#maxRequestsPerConnectionV2">maxRequestsPerConnectionV2</a></li><li><a href="global.html#maxRequestsPerConnectionV3">maxRequestsPerConnectionV3</a></li><li><a href="global.html#newQueryPlan">newQueryPlan</a></li><li><a href="global.html#objectValues">objectValues</a></li><li><a href="global.html#optionalCallback">optionalCallback</a></li><li><a href="global.html#parallel">parallel</a></li><li><a href="global.html#parseVectorTypeArgs">parseVectorTypeArgs</a></li><li><a href="global.html#promiseWrapper">promiseWrapper</a></li><li><a href="global.html#releasableSize">releasableSize</a></li><li><a href="global.html#resultFlag">resultFlag</a></li><li><a href="global.html#rowBuffer">rowBuffer</a></li><li><a href="global.html#series">series</a></li><li><a href="global.html#setMetadataDependent">setMetadataDependent</a></li><li><a href="global.html#shiftToGroup">shiftToGroup</a></li><li><a href="global.html#stringRepeat">stringRepeat</a></li><li><a href="global.html#throwNotSupported">throwNotSupported</a></li><li><a href="global.html#times">times</a></li><li><a href="global.html#timesLimit">timesLimit</a></li><li><a href="global.html#timesSeries">timesSeries</a></li><li><a href="global.html#toBackground">toBackground</a></li><li><a href="global.html#toCallback">toCallback</a></li><li><a href="global.html#toLowerCaseProperties">toLowerCaseProperties</a></li><li><a href="global.html#totalLength">totalLength</a></li><li><a href="global.html#validateFn">validateFn</a></li><li><a href="global.html#whilst">whilst</a></li></ul>
</nav>

<br class="clear">

<footer>
    Documentation generated by <a href="https://github.com/jsdoc/jsdoc">JSDoc 4.0.4</a> on Wed Nov 27 2024 09:28:44 GMT+0000 (Coordinated Universal Time)
</footer>

<script> prettyPrint(); </script>
<script src="scripts/linenumber.js"> </script>
</body>
</html>
